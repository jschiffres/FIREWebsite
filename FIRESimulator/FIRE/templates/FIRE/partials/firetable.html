<form>
    <div>
        <button type="submit" class="btn btn-success" hx-post="{% url 'runsimulation' simulation.id %}" hx-target="#runsimulation-div" hx-swap="innerHTML">Update!</button>
    </div>
    <div class="container tbl-container">
        <div class="row tbl-fixed">
            <table class="table table-striped table-hover table-condensed">
                <thead>
                    <tr style="text-align: center;">
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="2">RETIREMENT AGE</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">SALARY GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">BONUS PERCENTAGE</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="2">OTHER INCOME GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">FIXED COSTS INFLATION</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">VARIABLE COSTS INFLATION</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">HEALTH INSURANCE INFLATION</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">TAX RATE</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">-</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="4">HEALTH SAVINGS ACCOUNT GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="3">EMPLOYER SPONSORED RETIREMENT PLAN GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="2">EMPLOYER CONTRIBUTION SALARY MATCH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="4">INDIVIDUAL RETIREMENT ACCOUNT GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="3">TAXABLE BROKERAGE ACCOUNT GROWTH</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="1">ASSETS</th>
                        <th style="white-space:nowrap; color:#3F3F76; background-color:#FFCC99;" colspan="3">LOGIC</th>
                    </tr>

                    <tr style="text-align: center;">
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="2"><input type="number" class="" id="estimated_retirement_age" name="estimated_retirement_age" min="{{ simulation.current_age }}" max="101" value="{{ simulation.estimated_retirement_age }}" step="1" required></th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1"><input type="number" class="" id="estimated_salary_raise" name="estimated_salary_raise" min="0" max="99.9" value="{{ simulation.estimated_salary_raise }}" step=".1" required>%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1"><input type="number" class="" id="estimated_bonus" name="estimated_bonus" min="0" max="99.9" value="{{ simulation.estimated_bonus }}" step=".1" required>%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="2">{{ simulation.estimated_other_income_increase }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">{{ simulation.estimated_fixed_costs_inflation }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">{{ simulation.estimated_cost_of_living_inflation }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">{{ simulation.estimated_health_insurance_inflation }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">{{ simulation.estimated_tax_rate }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">-</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="4">{{ simulation.esitmated_hsa_yearly_return }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="3">{{ simulation.esitmated_401k_yearly_return }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="2">{{ simulation.current_401k_employer_contribution }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="4">{{ simulation.esitmated_ira_yearly_return }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="3">{{ simulation.esitmated_iba_yearly_return }}%</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff;" colspan="1">-</th>
                        <th style="white-space:nowrap; color:#000000; background-color:#ffffff; font-size: 50%;" colspan="3">Magic Number = (Fixed Costs + Variable Costs + Health Insurance) x 25<br>Drawdown = (Fixed Costs + Variable Costs + Health Insurance) / Net Worth</th>
                    </tr>

                    <tr class="second" style="text-align: center;">
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="2">PERSONAL INFO</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="4">INCOME</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="4">EXPENSES</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="1">-</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="4">HEALTH SAVINGS ACCOUNT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="5">EMPLOYER SPONSORED RETIREMENT PLAN</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="4">INDIVIDUAL RETIREMENT ACCOUNT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="3">TAXABLE BROKERAGE ACCOUNT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="1">ASSETS</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;" colspan="3">FIRE INDICATORS</th>
                    </tr>

                    <tr class="first" style="text-align: center;">
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">AGE</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">YEAR</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">SALARY</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">BONUS</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">OTHER INCOME</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">LUMP SUM PAYMENTS <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">+</button></th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#FF0000;">FIXED COSTS</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#FF0000;">VARIABLE COSTS</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#FF0000;">HEALTH INSURANCE</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#FF0000;">TAXES</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">SAVINGS</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">HSA START</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">HSA CONTRIBUTION LIMIT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">HSA CONTRIBUTION</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">HSA END</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">RETIREMENT PLAN START</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">RETIREMENT PLAN CONTRIBUTION LIMIT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">RETIREMENT PLAN CONTRIBUTION</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">RETIREMENT PLAN EMPLOYER CONTRIBUTION</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">RETIREMENT PLAN END</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">IRA START</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">IRA CONTRIBUTION LIMIT</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">IRA CONTRIBUTION</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">IRA END</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">TBA START</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#9B9B9B;">TBA CONTRIBUTION</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">TBA END</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#70AD47;">TOTAL ASSETS VALUE</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#000000;">NET WORTH</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#7030A0;">MAGIC NUMBER</th>
                        <th style="white-space:nowrap; color:#ffffff; background-color:#7030A0;">DRAWDOWN %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in data %}
                    <tr style="text-align: center;">
                        <td style="background-color:#EDEDED;">{{ d.age }}</td>
                        <td style="background-color:#EDEDED;">{{ d.year }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.salary }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.bonus }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.other_income }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.lump_sum_payment }}</td>
                        <td style="background-color:#FFCCCC;">{{ d.fixed_cost }}</td>
                        <td style="background-color:#FFCCCC;">{{ d.variable_cost }}</td>
                        <td style="background-color:#FFCCCC;">{{ d.health_insurance }}</td>
                        <td style="background-color:#FFCCCC;">{{ d.tax }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.saving }}</td>
                        <td style="background-color:#EDEDED;">{{ d.hsa_start }}</td>
                        <td style="background-color:#EDEDED;">{{ d.hsa_cont_limit }}</td>
                        <td style="background-color:#EDEDED;">{{ d.hsa_contribution }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.hsa_end }}</td>
                        <td style="background-color:#EDEDED;">{{ d.retirement_start }}</td>
                        <td style="background-color:#EDEDED;">{{ d.retirement_cont_limit }}</td>
                        <td style="background-color:#EDEDED;">{{ d.retirement_contribution }}</td>
                        <td style="background-color:#EDEDED;">{{ d.employer_retirement_contribution }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.retirement_end }}</td>
                        <td style="background-color:#EDEDED;">{{ d.ira_start }}</td>
                        <td style="background-color:#EDEDED;">{{ d.ira_cont_limit }}</td>
                        <td style="background-color:#EDEDED;">{{ d.ira_contribution }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.ira_end }}</td>
                        <td style="background-color:#EDEDED;">{{ d.iba_start }}</td>
                        <td style="background-color:#EDEDED;">{{ d.iba_contribution }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.iba_end }}</td>
                        <td style="background-color:#E2EFDA;">{{ d.asset_value }}</td>
                        <td style="background-color:#D0CECE;">{{ d.net_worth }}</td>
                        <td style="background-color:#CDACE6;">{{ d.magic_number }}</td>
                        <td style="background-color:#CDACE6;">{{ d.drawdown }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
        <div class="modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Lump Sum Payments</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="lumpsumincome-div">
                            {% if simulation.estimated_lumpsum_payment_amounts %}
                            {% for age, payment in lump_sum_payments %}
                            <div id="lumpsumincome-entry" class="row justify-content-start">
                                <div class="col-5">
                                    <div class="form-floating mb-3">
                                        <input type="number" class="form-control" id="estimated_lumpsum_payment_amounts" name="estimated_lumpsum_payment_amounts" min="0" max="10000000" value="{{ payment }}" required>
                                        <label for="estimated_lumpsum_payment_amounts">Amount ($)</label>
                                        <div id="estimated_lumpsum_payment_amountsHelp" class="form-text"><small>How much  one-time payments?</small></i></div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating mb-3">
                                        <input type="number" class="form-control" id="estimated_lumpsum_payment_ages" name="estimated_lumpsum_payment_ages" min="1" max="101" value="{{ age }}" step="1" required>
                                        <label for="estimated_lumpsum_payment_ages">Age</label>
                                        <div id="estimated_lumpsum_payment_agesHelp" class="form-text"><small>What age do you anticipate to recieve this one-time payment?</small></div>
                                    </div>
                                </div>
                                <div class="col-1">
                                    <button type="button" class="btn btn-danger" hx-delete hx-target="#lumpsumincome-entry" hx-swap="delete">-</button>
                                </div>
                                <hr>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <div>
                            <button type="button" class="btn btn-success" hx-get="{% url 'create-lumpsum-income' %}" hx-target="#lumpsumincome-div" hx-swap="beforeend">+ Add Lump Sum</button>
                            <p class="form-text"><small><i>*One entry per year before retirement age</i></small></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success" data-bs-dismiss="modal" hx-post="{% url 'runsimulation' simulation.id %}" hx-target="#runsimulation-div" hx-swap="innerHTML">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
</form>

<div>
    <canvas id="myChart" style="display: block;"></canvas>
</div>

<script>
    const ctx = document.getElementById('myChart');
    new Chart(ctx, {
        type: 'line',
        data: {
        labels: {{ages|safe}},
        datasets: [{
            label: 'Net Worth',
            data: {{net_worths|safe}},
            borderWidth: 1
        }]
        },
    });
    Chart.update()
</script>

